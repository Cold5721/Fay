# Fay日程管理MCP Server

基于MCP协议的智能日程管理系统，深度集成Fay数字人助手，提供自然语言日程管理和自动提醒功能。

## 核心功能

### 📅 日程管理
- **智能解析**：自然语言输入，如"明天上午提醒我开会"
- **灵活调度**：支持单次和周期性任务
- **状态管理**：活跃、完成、删除状态跟踪
- **多用户支持**：基于UID的用户隔离

### 🌐 Web管理界面
- **自动启动**：连接MCP时自动开启Web界面（http://localhost:5011）
- **可视化管理**：卡片式日程展示，支持增删改查
- **高级筛选**：按状态、日期、关键词筛选
- **响应式设计**：支持PC和移动端访问

### 🤖 Fay集成
- **语音提醒**：到时自动通过Fay播报提醒
- **智能交互**：支持语音和文字双向沟通
- **无缝集成**：原生支持Fay的文字沟通接口

## 快速开始

### 1. 安装依赖

```bash
pip install mcp flask flask-cors
```

### 2. 配置Fay

在Fay的MCP管理界面添加：
- **名称**: Fay日程管理
- **类型**: STDIO（本地）
- **命令**: python
- **参数**: server.py
- **工作目录**: mcp_servers/schedule_manager

### 3. 使用方式

#### 通过Fay语音交互
- "明天上午9点提醒我开会"
- "查看今天的日程"
- "取消下午3点的会议"

#### 通过Web界面管理
连接MCP后访问 http://localhost:5011

## MCP工具说明

### add_schedule
添加日程任务

**参数**：
- `title`: 日程标题
- `content`: 详细内容
- `schedule_time`: 执行时间（YYYY-MM-DD HH:MM）
- `repeat_rule`: 重复规则（7位数字，1=重复，0=不重复）
- `uid`: 用户ID

### get_schedules
获取日程列表

**参数**：
- `status`: 状态筛选（active/completed/deleted）
- `uid`: 用户ID筛选

### update_schedule
更新日程信息

### delete_schedule
删除日程（软删除）

### send_message_to_fay
直接发送消息给Fay

## 技术架构

```
┌─────────────┐     ┌──────────┐     ┌───────────┐
│   Fay主程序  │────▶│ MCP Server│────▶│  Web界面   │
└─────────────┘     └──────────┘     └───────────┘
       │                  │                 │
       └──────────────────┴─────────────────┘
                          │
                    ┌──────────┐
                    │  SQLite   │
                    └──────────┘
```

## 数据存储

使用SQLite数据库（schedules.db）存储日程：

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | INTEGER | 主键 |
| title | TEXT | 标题 |
| content | TEXT | 内容 |
| schedule_time | TEXT | 执行时间 |
| repeat_rule | TEXT | 重复规则 |
| status | TEXT | 状态 |
| uid | INTEGER | 用户ID |

## 重复规则说明

7位数字字符串，每位代表周一到周日：
- `0000000`: 单次执行
- `1111100`: 工作日重复
- `1111111`: 每日重复
- `1000100`: 周一和周五重复

## 注意事项

1. **端口占用**：Web界面使用5011端口，确保未被占用
2. **时区设置**：使用系统本地时区
3. **进程管理**：断开MCP连接时Web服务器自动关闭
4. **数据安全**：日程数据存储在本地，注意备份

## 故障排除

### Web界面无法访问
- 检查5011端口是否被占用
- 确认MCP服务器已连接
- 查看日志确认Web服务器已启动

### 提醒未触发
- 检查日程时间设置是否正确
- 确认Fay主程序正在运行
- 查看日程状态是否为active

### 自然语言解析错误
- 使用更明确的时间表述
- 避免过于复杂的句式
- 参考示例格式输入

## 更新日志

### v1.2.0 (2025-08-23)
- 新增自然语言解析功能
- 集成Web管理界面
- 优化进程生命周期管理
- 修复重复提醒问题

### v1.0.0
- 基础日程管理功能
- MCP协议支持
- Fay集成

## 许可证

MIT License